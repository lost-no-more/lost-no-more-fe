name: Daily PR Summary
on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰ (UTC 0ì‹œ ê¸°ì¤€, í•œêµ­ì‹œê°„ 09:00)
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  pr_summary:
    runs-on: ubuntu-latest
    steps:
      - name: Get PR List
        id: pr-list
        uses: actions/github-script@v6
        with:
          script: |
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open'
            });

            if (prs.data.length === 0) {
              return 'No open PRs today!';
            }

            const prList = prs.data.map(pr => {
              const createdAt = new Date(pr.created_at).toLocaleDateString('ko-KR');
              return `- [${pr.title}](${pr.html_url})
                ë§í¬: ${pr.html_url}
                ìƒì„±ì¼: ${new Date(pr.created_at).toLocaleDateString('ko-KR')}
                ì‘ì„±ì: ${pr.user.login}
                ë¦¬ë·°ì–´: ${pr.requested_reviewers.map(r => r.login).join(', ') || 'ì—†ìŒ'}
                ë¸Œëœì¹˜: ${pr.head.ref} -> ${pr.base.ref}
                ì»¤ë°‹ ìˆ˜: ${pr.commits}
                ë³€ê²½ëœ íŒŒì¼: ${pr.changed_files}ê°œ
            }).join('\n');

            return `ğŸ“‹ í˜„ì¬ ì—´ë ¤ìˆëŠ” PR ëª©ë¡ (ì´ ${prs.data.length}ê°œ)\n\n${prList}`;

      - name: Send to Discord
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: ${{ steps.pr-list.outputs.result }}
